import streamlit as st
import pandas as pd
import numpy as np
import plotly.express as px

st.set_page_config(page_title="PolarView", layout="wide")
st.title("üåç‚ùÑÔ∏è PolarView ‚Äî ‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á‡∏Ç‡∏±‡πâ‡∏ß‡πÇ‡∏•‡∏Å & ‡∏™‡∏†‡∏≤‡∏û‡∏≠‡∏≤‡∏Å‡∏≤‡∏®‡πÇ‡∏•‡∏Å‡∏õ‡∏µ 2024")

st.markdown("""
‡πÇ‡∏õ‡∏£‡πÅ‡∏Å‡∏£‡∏°‡∏ô‡∏µ‡πâ‡πÅ‡∏™‡∏î‡∏á‡∏ú‡∏•  
- ‡∏Å‡∏≤‡∏£‡∏•‡∏∞‡∏•‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á‡∏Ç‡∏±‡πâ‡∏ß‡πÇ‡∏•‡∏Å  
- ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏ó‡∏∞‡πÄ‡∏•‡∏´‡∏•‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®  
- ‡∏Å‡∏≤‡∏£‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÅ‡∏≠‡∏ô‡∏¥‡πÄ‡∏°‡∏ä‡∏±‡∏ô  
- ‡πÉ‡∏ä‡πâ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å NASA / NOAA (‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏´‡∏£‡∏∑‡∏≠ API)  
""")

# -------------------------------------------------------------------
# 1) ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å NASA ‡∏´‡∏£‡∏∑‡∏≠ NOAA
# -------------------------------------------------------------------
st.header("üå°Ô∏è ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‡∏à‡∏≤‡∏Å NASA/NOAA (‡∏õ‡∏µ 2024)")

uploaded_file = st.file_uploader("‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏ü‡∏•‡πå‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• NASA/NOAA (CSV)", type=["csv"])

if uploaded_file:
    real_data = pd.read_csv(uploaded_file)

    st.success("‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!")
    st.dataframe(real_data.head())

    st.subheader("üìà ‡∏Å‡∏£‡∏≤‡∏ü‡∏à‡∏≤‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á ‡∏õ‡∏µ 2024")
    col = st.selectbox("‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏î‡∏π", real_data.columns[1:])

    fig_real = px.line(real_data, x=real_data.columns[0], y=col,
                       title=f"‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏° {col} ‡∏õ‡∏µ 2024")
    st.plotly_chart(fig_real, use_container_width=True)
else:
    st.info("‡∏£‡∏≠‡∏≠‡∏±‡∏õ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏£‡∏¥‡∏á‚Ä¶ (NASA / NOAA)")

# -------------------------------------------------------------------
# 2) ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏∞‡∏•‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á (Animation)
# -------------------------------------------------------------------
st.header("‚ùÑÔ∏è Animation: ‡∏Å‡∏≤‡∏£‡∏•‡∏∞‡∏•‡∏≤‡∏¢‡∏Ç‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á‡∏Ç‡∏±‡πâ‡∏ß‡πÇ‡∏•‡∏Å")

temp_inc = st.slider("‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÇ‡∏•‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô (¬∞C)", 0.0, 5.0, 1.5, 0.1)
years = st.slider("‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏õ‡∏µ‡∏ó‡∏µ‡πà‡∏à‡∏≥‡∏•‡∏≠‡∏á", 10, 100, 50, 10)

year_list = np.arange(0, years + 1)

# ‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÅ‡∏ö‡∏ö‡∏á‡πà‡∏≤‡∏¢
ice_left = 100 - (temp_inc * 5 * (year_list / years) * 1.2)
ice_left = np.clip(ice_left, 0, 100)
sea_level = (100 - ice_left) * 0.8

df_sim = pd.DataFrame({
    "‡∏õ‡∏µ": year_list,
    "‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (%)": ice_left,
    "‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏ó‡∏∞‡πÄ‡∏• (mm)": sea_level
})

fig_ani = px.line(
    df_sim,
    x="‡∏õ‡∏µ",
    y="‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á‡∏ó‡∏µ‡πà‡πÄ‡∏´‡∏•‡∏∑‡∏≠ (%)",
    title="Animation ‚Äî ‡∏Å‡∏≤‡∏£‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÅ‡∏õ‡∏•‡∏á‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á‡πÉ‡∏ô‡∏≠‡∏ô‡∏≤‡∏Ñ‡∏ï",
    markers=True
)
fig_ani.update_traces(mode="lines+markers")
st.plotly_chart(fig_ani, use_container_width=True)

# -------------------------------------------------------------------
# 3) ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®
# -------------------------------------------------------------------
st.header("üåè ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏ó‡∏∞‡πÄ‡∏•‡∏´‡∏•‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®")

country_data = {
    "Thailand": 120,
    "Japan": 105,
    "USA": 98,
    "Bangladesh": 150,
    "Netherlands": 160
}

df_country = pd.DataFrame(list(country_data.items()), columns=["‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®", "‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏ó‡∏∞‡πÄ‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏° (‡∏°‡∏°.)"])

fig_country = px.bar(
    df_country,
    x="‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®",
    y="‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏ó‡∏∞‡πÄ‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏° (‡∏°‡∏°.)",
    title="‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏ó‡∏∞‡πÄ‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô ‚Äî ‡πÄ‡∏õ‡∏£‡∏µ‡∏¢‡∏ö‡πÄ‡∏ó‡∏µ‡∏¢‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®",
    color="‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏ó‡∏∞‡πÄ‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏° (‡∏°‡∏°.)"
)

st.plotly_chart(fig_country, use_container_width=True)

# -------------------------------------------------------------------
# 4) ‡∏™‡∏£‡∏∏‡∏õ‡∏ú‡∏•‡∏õ‡∏µ 2024
# -------------------------------------------------------------------
st.header("üìå ‡∏™‡∏£‡∏∏‡∏õ‡∏™‡∏ñ‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡∏ì‡πå‡∏õ‡∏µ 2024")

st.success(f"""
üîπ ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡πÇ‡∏•‡∏Å‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô: **{temp_inc}¬∞C**  
üîπ ‡∏ô‡πâ‡∏≥‡πÅ‡∏Ç‡πá‡∏á‡∏Ç‡∏±‡πâ‡∏ß‡πÇ‡∏•‡∏Å‡πÄ‡∏´‡∏•‡∏∑‡∏≠: **{ice_left[-1]:.2f}%**  
üîπ ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ô‡πâ‡∏≥‡∏ó‡∏∞‡πÄ‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏Ç‡∏∂‡πâ‡∏ô: **{sea_level[-1]:.2f} ‡∏°‡∏°.**  
üîπ ‡∏õ‡∏£‡∏∞‡πÄ‡∏ó‡∏®‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏ú‡∏•‡∏Å‡∏£‡∏∞‡∏ó‡∏ö‡∏°‡∏≤‡∏Å‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î: **Netherlands & Bangladesh**
""")

st.info("‡∏ô‡∏µ‡πà‡πÄ‡∏õ‡πá‡∏ô‡πÇ‡∏°‡πÄ‡∏î‡∏•‡∏à‡∏≥‡∏•‡∏≠‡∏á‡πÄ‡∏ä‡∏¥‡∏á‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥ ‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏ï‡πà‡∏≠‡∏¢‡∏≠‡∏î‡∏î‡πâ‡∏ß‡∏¢ AI/ML ‡πÑ‡∏î‡πâ")
